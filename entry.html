<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FOSDEM 2026 - Join</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="entry-page">
        <div class="entry-card">
            <div class="entry-logo">ðŸ‡§ðŸ‡ª</div>
            <h1 class="entry-title">FOSDEM 2026</h1>
            <p class="entry-subtitle">Coordinate with your group</p>
            <form class="entry-form" id="entryForm">
                <input type="text" class="entry-input" id="groupNameInput" placeholder="Group Password / Secret" maxlength="30" required>
                <input type="text" class="entry-input" id="nicknameInput" placeholder="Your nickname" maxlength="20" required>
                <input type="number" class="entry-input hidden" id="pinInput" placeholder="4-digit PIN" minlength="4" maxlength="4">
                <button type="submit" class="btn-primary" id="entryButton">Join Group</button>
            </form>
            <p id="entryError" class="error-message hidden"></p>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-auth-compat.js"></script>
    <script src="app.js"></script>
    <script>
        const entryForm = document.getElementById('entryForm');
        const entryError = document.getElementById('entryError');
        const entryTitle = document.querySelector('.entry-title');
        const entrySubtitle = document.querySelector('.entry-subtitle');
        const pinInput = document.getElementById('pinInput');
        const entryButton = document.getElementById('entryButton');

        // Check if already logged in
        if (FosdemApp.checkSavedSession()) {
            window.location.href = 'schedule.html';
        }

        entryForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            entryError.classList.add('hidden');

            const nickname = document.getElementById('nicknameInput').value.trim();
            const group = document.getElementById('groupNameInput').value.trim();
            const pin = pinInput.value.trim();

            if (!pinInput.classList.contains('hidden')) {
                if (!pin || pin.length < 4) {
                    showError('Please enter a 4-digit PIN');
                    return;
                }
                try {
                    await FosdemApp.register(nickname, group, pin);
                    window.location.href = 'schedule.html';
                } catch (error) {
                    showError(error.message || 'Incorrect PIN');
                }
                return;
            }

            const existingUser = await FosdemApp.findUserByNickname(group, nickname);

            if (existingUser) {
                entryTitle.textContent = 'Welcome back!';
                entrySubtitle.textContent = 'Enter your PIN to reclaim your identity';
                pinInput.classList.remove('hidden');
                pinInput.required = true;
                pinInput.placeholder = 'Enter your 4-digit PIN';
                pinInput.focus();
                entryButton.textContent = 'Verify & Join';
                return;
            }

            entryTitle.textContent = 'Create your identity';
            entrySubtitle.textContent = 'Choose a 4-digit PIN to protect your nickname';
            pinInput.classList.remove('hidden');
            pinInput.required = true;
            pinInput.placeholder = 'Choose a 4-digit PIN';
            pinInput.focus();
            entryButton.textContent = 'Create & Join';
        });

        function showError(msg) {
            entryError.textContent = msg;
            entryError.classList.remove('hidden');
        }
    </script>
</body>
</html>
